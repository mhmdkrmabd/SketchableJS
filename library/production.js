/* SketchableJS Library v1.0.0 | (Under MIT License) | Â© Muhammad A. Abu Baker | GitHub: https://github.com/mhmdkrmabd/sketchablejs */
class Sketchable{constructor(c,o="d"){this.q=c,this.e=c.getContext("2d"),this.d=[c.width,c.height,2,"#000","round","#fff"];let m=this;if("d"==o)this.l=this.d[0],this.k=this.d[1],this.z={s:this.d[2],c:this.d[3],t:this.d[4]},this.v=this.d[5];else{let w=["width","height","penSize","penColor","penType","backgroundColor"],h=new Array(w.length);for(var i=0;i<w.length;){let j=" > 0";i>=3&&(j=".length != 0"),eval("o."+w[i]+" != undefined && o."+w[i]+j)?eval("h["+i+"] = o."+w[i]):h[i]=m.d[i],++i}this.l=h[0],this.k=h[1],this.z={s:h[2],c:h[3],t:h[4]},this.v=h[5]}this.q.width=this.l,this.q.height=this.k,this.e.fillStyle=this.v,this.e.fillRect(0,0,this.q.width,this.q.height),this._r=!1,this._t=!1,this._y=!1,this._u=[],this._i=[],this._o=!0,this._p={s:this.d[2],c:this.d[3],t:this.d[4]},this.q.addEventListener("mousedown",function(t){m._sp(t)}),this.q.addEventListener("mouseup",function(){m._fp()}),this.q.addEventListener("mousemove",function(t){m._sh(t)})}_sp(t){this._r||(this._y=!0,this._sh(t))}_fp(){this._r||(this._y=!1,this._u.push("PR"),this.e.beginPath())}_sh(t){if(!this._r){if(!this._y)return void this.e.beginPath();this._d(this.z.s,this.z.c,this.z.t,t.offsetX,t.offsetY)}}_d(t,i,h,s,e,l=!0){if(this.e.lineWidth=t,this.e.strokeStyle=i,this.e.lineCap=h,this.e.lineTo(s,e),this.e.stroke(),this.e.beginPath(),this.e.moveTo(s,e),l){if(this._o){let s="CH:"+t+","+i+","+h;this._u.push(s),this._o=!1}let l={x:s,y:e};this._u.push(l)}}redraw(t=!1,i=15,h="n"){if(!this._r){this.clear(!1);let e=this;if(t)(isNaN(i)||null==i||null==i||i<=0)&&(i=15),this._t=!1,this._r_a(0,i,h);else for(var s=0;s<this._u.length;){let t=this._u[s];"PR"==t?this.e.beginPath():null==t.x&&-1!=t.indexOf("CH:")?(t=t.replace("CH:","").split(","),this._p.s=t[0],this._p.c=t[1],this._p.t=t[2]):e._d(this._p.s,this._p.c,this._p.t,t.x,t.y,!1),++s}}}_r_a(t,i,h){if(this._r=!0,this._t)this._t=!1,this._r=!1,this.e.beginPath(),this.redraw();else{let s=this;if(t<=this._u.length-1){let e=this._u[t];"PR"==e?s.e.beginPath():null==e.x&&-1!=e.indexOf("CH:")?(e=e.replace("CH:","").split(","),this._p.s=e[0],this._p.c=e[1],this._p.t=e[2]):s._d(this._p.s,this._p.c,this._p.t,e.x,e.y,!1),++t,setTimeout(function(){s._r_a(t,i,h)},i)}else this._r=!1,null!=h&&"n"!=h&&h()}}stopRedrawAnimation(){this._t=!0}clear(t=!0){this._r||(this.e.stroke(),this.e.clearRect(0,0,this.q.width,this.q.height),this.e.fillStyle=this.v,this.e.fillRect(0,0,this.q.width,this.q.height),t&&(this._u=[],this._i=[]))}undo(t="n"){if(!this._r){let i=this;if(i._u.length>0)if("n"==t)i._i.push(i._u[i._u.length-1]),i._u.pop(),i.undo("y");else{let t=i._u[i._u.length-1];"PR"==t?i.redraw():(i._i.push(t),i._u.pop(),i.undo("y"))}else i.clear(!1)}}redo(t="n"){if(!this._r){let i=this;if(i._i.length>0)if("n"==t)i._u.push(i._i[i._i.length-1]),i._i.pop(),i.redo("y");else{let t=i._i[i._i.length-1];i._u.push(t),i._i.pop(),"PR"==t?i.redraw():i.redo("y")}}}returnToDefaults(){this.z={s:this.d[2],c:this.d[3],t:this.d[4]},this.v=this.d[5],this.redraw()}changeBackgroundColor(t){this._r||(this.v=t,this.redraw())}export(){if(!this._r){let t;return(t=this._u).push(this.v),JSON.stringify(t)}}import(t){if(!this._r){let i;try{i=JSON.parse(t)}catch(t){return-1}if(null==i[i.length-1]||null==i[i.length-1])return-1;let h=i[i.length-1];i=i.slice(0,i.length-1),this._u=i,this._i=[],this.changeBackgroundColor(h)}}penSize(t){this._r||null!=t&&null!=t&&t>0&&!isNaN(t)&&t>0&&(this.z.s=t,this._o=!0)}penColor(t){this._r||null!=t&&null!=t&&t.length>0&&(this.z.c=t,this._o=!0)}penType(t){if(!this._r){let i=["butt","round","square"];0!=t.length&&i.includes(t)&&(this.z.t=t,this._o=!0)}}listAttriubtes(){return{Dimensions:{Width:this.l,Height:this.k},Pen:{Size:this.z.s,Color:this.z.c,Type:this.z.t},Draw:{Saved:this._u.length,Deleted:this._i.length},Actions:{Sketching:this._y,Redrawing:this._r},BackgroundColor:this.v}}}
